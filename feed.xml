<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Da xia çš„æŠ€æœ¯åšå®¢</title>
    <description>åŒ—äº¬</description>
    <link>http://zdaxia.com/</link>
    <atom:link href="http://zdaxia.com/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Fri, 15 Feb 2019 14:51:59 +0800</pubDate>
    <lastBuildDate>Fri, 15 Feb 2019 14:51:59 +0800</lastBuildDate>
    <generator>Jekyll v3.2.0</generator>
    
      <item>
        <title>Porter-Duff Blending å®ç°é•‚ç©ºæ–‡å­—æ•ˆæœ</title>
        <description>&lt;h3&gt;Blend Modes&lt;/h3&gt;

&lt;p&gt;åœ¨ Core Graphics ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è®¾ç½® Blend Mode æ··åˆä¸¤å¼ å›¾ç‰‡ï¼Œæˆ–è€…æŠŠå›¾ç‰‡æ··åˆåˆ°å½“å‰ context çš„èƒŒæ™¯ä¸­ã€‚é€šå¸¸çš„ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;ç»˜åˆ¶èƒŒæ™¯&lt;/li&gt;
&lt;li&gt;è®¾ç½® &lt;a href=&quot;https://developer.apple.com/documentation/coregraphics/1455994-cgcontextsetblendmode&quot;&gt;CGContextSetBlendMode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ç»˜åˆ¶å›¾ç‰‡åˆ°èƒŒæ™¯ä¸Š&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;æœ‰ä¸¤å¼ å›¾ç‰‡&lt;/p&gt;

&lt;div align=center&gt;
&lt;img src=&quot;../../../images/Blend-Model/both_images.jpg&quot; width = &quot;500&quot;/&gt;
&lt;/div&gt;

&lt;!--![](../images/Blend-Model/both_images.jpg)
--&gt;

&lt;p&gt;ä½¿ç”¨ &lt;code&gt;kCGBlendModeMultiply&lt;/code&gt; æ··åˆåçš„ç»“æœæ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;

&lt;div align=center&gt;
&lt;img src=&quot;../../../images/Blend-Model/multiply_image.jpg&quot; width = &quot;250&quot;/&gt;
&lt;/div&gt;

&lt;!--![](../images/Blend-Model/multiply_image.jpg)
--&gt;

&lt;p&gt;&lt;code&gt;CGBlendMode&lt;/code&gt; å®šä¹‰äº†å¾ˆå¤šç§æ··åˆæ¨¡å¼ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œå…¶ä¸­ç¬¬ä¸€éƒ¨åˆ†çš„æ··åˆæ•ˆæœåœ¨ &lt;a href=&quot;https://developer.apple.com/library/archive/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_images/dq_images.html#//apple_ref/doc/uid/TP30001066-CH212-CJBIJEFG&quot;&gt;Using Blend Modes with Images&lt;/a&gt; å¯ä»¥æŸ¥çœ‹ã€‚ä¸‹ä¸€èŠ‚ä¸€èµ·æ¥äº†è§£ä¸‹ ç¬¬äºŒéƒ¨åˆ†çš„æ··åˆæ¨¡å¼ï¼ˆPorter-Duffï¼‰ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;typedef CF_ENUM (int32_t, CGBlendMode) {
    /* Available in Mac OS X 10.4 &amp;amp; later. */
    kCGBlendModeNormal,
    kCGBlendModeMultiply,
    kCGBlendModeScreen,
    kCGBlendModeOverlay,
    kCGBlendModeDarken,
    kCGBlendModeLighten,
    kCGBlendModeColorDodge,
    kCGBlendModeColorBurn,
    kCGBlendModeSoftLight,
    kCGBlendModeHardLight,
    kCGBlendModeDifference,
    kCGBlendModeExclusion,
    kCGBlendModeHue,
    kCGBlendModeSaturation,
    kCGBlendModeColor,
    kCGBlendModeLuminosity,

    /* Available in Mac OS X 10.5 &amp;amp; later. R, S, and D are, respectively,
       premultiplied result, source, and destination colors with alpha; Ra,
       Sa, and Da are the alpha components of these colors.

       The Porter-Duff &amp;quot;source over&amp;quot; mode is called `kCGBlendModeNormal&amp;#39;:
         R = S + D*(1 - Sa)

       Note that the Porter-Duff &amp;quot;XOR&amp;quot; mode is only titularly related to the
       classical bitmap XOR operation (which is unsupported by
       CoreGraphics). */

    kCGBlendModeClear,                  /* R = 0 */
    kCGBlendModeCopy,                   /* R = S */
    kCGBlendModeSourceIn,               /* R = S*Da */
    kCGBlendModeSourceOut,              /* R = S*(1 - Da) */
    kCGBlendModeSourceAtop,             /* R = S*Da + D*(1 - Sa) */
    kCGBlendModeDestinationOver,        /* R = S*(1 - Da) + D */
    kCGBlendModeDestinationIn,          /* R = D*Sa */
    kCGBlendModeDestinationOut,         /* R = D*(1 - Sa) */
    kCGBlendModeDestinationAtop,        /* R = S*(1 - Da) + D*Sa */
    kCGBlendModeXOR,                    /* R = S*(1 - Da) + D*(1 - Sa) */
    kCGBlendModePlusDarker,             /* R = MAX(0, (1 - D) + (1 - S)) */
    kCGBlendModePlusLighter             /* R = MIN(1, S + D) */
};
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;h3&gt;Porter-Duff&lt;/h3&gt;

&lt;p&gt;Porter-Duff è¿™ä¸ªåè¯æ˜¯ä¸ºäº†è¡¨è¾¾å¯¹ Thomas Porter å’Œ Tom Duff çš„æ•¬æ„ï¼Œä»–ä»¬äº 1984 å¹´å‘è¡¨äº†ä¸€ç¯‡åä¸º â€œ&lt;a href=&quot;https://dl.acm.org/citation.cfm?id=808606&quot;&gt;Compositing Digital Images&lt;/a&gt;â€çš„å¼€åˆ›æ€§è®ºæ–‡ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä¸¤ä½ä½œè€…æè¿°äº†12ç§åˆæˆæ“ä½œç¬¦ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯å½“æˆ‘ä»¬æŠŠåŸå›¾åƒç»˜åˆ¶åˆ°ç›®æ ‡å›¾åƒå¤„æ—¶åº”è¯¥å¦‚ä½•è®¡ç®—äºŒè€…ç»“åˆåçš„é¢œè‰²ã€‚ç”±äº Porter å’Œ Duff çš„å·¥ä½œåªå…³æ³¨åŸå›¾åƒå’Œç›®æ ‡å›¾åƒå…±åŒç»˜åˆ¶å¯¹ alpha é€šé“ï¼ˆå³æˆ‘ä»¬æ‰€ç†è§£çš„é€æ˜åº¦ï¼‰çš„å½±å“ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆæŠŠåœ¨ä»–ä»¬è®ºæ–‡æ‰€æåˆ°çš„ 12 ç§æ“ä½œç§°ä¸º alpha åˆæˆæ¨¡å¼ã€‚ä¸‹é¢çœ‹ä¸€ä¸‹è¿™ 12 ä¸­åˆæˆæ¨¡å¼çš„ç»“æœï¼š&lt;/p&gt;

&lt;p&gt;æœ‰ä¸¤å¼ å›¾ç‰‡&lt;/p&gt;

&lt;p&gt;&lt;center class=&quot;half&quot;&gt;
    &lt;img src=&quot;../../../images/Blend-Model/source.png&quot; width = &quot;256&quot;/&gt;&lt;img src=&quot;../../../images/Blend-Model/destination.png&quot; width = &quot;256&quot;/&gt;
&lt;/center&gt;&lt;/p&gt;

&lt;!--![](../images/Blend-Model/source.png)
![](../images/Blend-Model/destination.png)--&gt;

&lt;p&gt;ä½¿ç”¨ä¸‹é¢çš„ä»£ç æµ‹è¯•æ··åˆåçš„æ•ˆæœï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;- (UIImage *)blendImageWithSize:(CGSize)size
{
    UIGraphicsBeginImageContext(size);

    UIImage *destinationImg = [UIImage imageNamed:@&amp;quot;destination.png&amp;quot;];
    [destinationImg drawInRect:CGRectMake(0, 0, size.width, size.height) blendMode:kCGBlendModeNormal alpha:1.f];
    UIImage *sourceImg = [UIImage imageNamed:@&amp;quot;source.png&amp;quot;];
    [sourceImg drawInRect:CGRectMake(0, 0, size.width, size.height) blendMode:kCGBlendModeCopy alpha:1.f];
    UIImage *newImage = UIGraphicsGetImageFromCurrentImageContext();

    UIGraphicsEndImageContext();

    return newImage;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;div align=center&gt;
    &lt;img src=&quot;../../../images/Blend-Model/porter-duff.jpg&quot; width = &quot;800&quot;/&gt;
&lt;/div&gt;

&lt;!--![](../images/Blend-Model/porter-duff.jpg)
--&gt;

&lt;p&gt;Demo åœ¨&lt;a href=&quot;https://github.com/daxiazhou/Demos/tree/master/BlendModesDemo&quot;&gt;è¿™é‡Œ&lt;/a&gt;ï¼Œå¯ä»¥æ‰‹åŠ¨è¿è¡Œèµ·æ¥è¯•è¯•å„ç§æ··åˆæ¨¡å¼çš„æ•ˆæœã€‚&lt;/p&gt;

&lt;h3&gt;å®ç°é•‚ç©ºæ–‡å­—æ•ˆæœ&lt;/h3&gt;

&lt;p&gt;äº†è§£äº†å„ç§æ··åˆæ¨¡å¼çš„æ•ˆæœï¼Œå®ç°é•‚ç©ºæ–‡å­—æ•ˆæœå°±ä¸éš¾äº†ã€‚è‡ªå®šä¹‰ä¸€ä¸ª Labelï¼Œé‡å†™ &lt;code&gt;drawRect:&lt;/code&gt; æ–¹æ³•ï¼Œç»„åˆè¿ç”¨æ··åˆæ¨¡å¼å°±å¯ä»¥å®ç°ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;- (void)drawRect:(CGRect)rect {
    [super drawRect:rect];
    CGContextRef context = UIGraphicsGetCurrentContext();
    // ç»˜åˆ¶åœ†è§’
    if (self.cornerRadius) {
        UIBezierPath *path = [UIBezierPath bezierPathWithRoundedRect:rect cornerRadius:self.cornerRadius];
        [path addClip];
        CGContextAddPath(context, path.CGPath);
    }

    CGContextSaveGState(context);
    // æ–‡å­—ä»¥å¤–åŒºåŸŸé¢œè‰²
    if (self.fillColor) {
        [self.fillColor setFill];
        UIRectFill(rect);
    }

    // å€ŸåŠ© UILabel ç»˜åˆ¶æ–‡å­—
    CGContextSetBlendMode(context, kCGBlendModeDestinationOut);
    UILabel *label = [[UILabel alloc] initWithFrame:rect];
    label.font = self.font;
    label.text = self.text;
    label.textAlignment = self.textAlignment;
    label.backgroundColor = [UIColor clearColor];
    [label.layer drawInContext:context];
    CGContextRestoreGState(context);

    // è¿˜å¯ä»¥åœ¨é•‚ç©ºæ–‡å­—ä¸ŠåŠ åŠé€æ˜è’™å±‚
//    UIColor *textColor = [[UIColor blackColor] colorWithAlphaComponent:0.2];
//    [textColor setFill];
//    UIRectFillUsingBlendMode(rect, kCGBlendModeDestinationOver);

}
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;æˆæœå±•ç¤º&lt;/p&gt;

&lt;div align=center&gt;
    &lt;img src=&quot;../../../images/Blend-Model/hollowLabelSample.jpg&quot; width = &quot;320&quot;/&gt;
&lt;/div&gt;

&lt;!--![](../images/Blend-Model/hollowLabelSample.jpg)
--&gt;

&lt;h3&gt;å‚è€ƒæ–‡ç« &lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://123sunxiaolin.github.io/2017/03/26/%5BUIVIew%5D%E8%B0%88%E8%B0%88%E5%AF%B9drawRect%E7%9A%84%E7%90%86%E8%A7%A3/&quot;&gt;è°ˆè°ˆå¯¹drawRectçš„ç†è§£&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Alpha_compositing&quot;&gt;Alpha compositing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://onevcat.com/2013/04/using-blending-in-ios/&quot;&gt;iOSä¸­ä½¿ç”¨blendæ”¹å˜å›¾ç‰‡é¢œè‰²
&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Thu, 14 Feb 2019 18:36:24 +0800</pubDate>
        <link>http://zdaxia.com/2019/02/Core-Graphics-%E5%AE%9E%E7%8E%B0%E9%95%82%E7%A9%BA%E6%96%87%E5%AD%97%E6%95%88%E6%9E%9C/</link>
        <guid isPermaLink="true">http://zdaxia.com/2019/02/Core-Graphics-%E5%AE%9E%E7%8E%B0%E9%95%82%E7%A9%BA%E6%96%87%E5%AD%97%E6%95%88%E6%9E%9C/</guid>
        
        
      </item>
    
      <item>
        <title>CoreText å®ç°é•‚ç©ºæ–‡å­—æ•ˆæœ</title>
        <description>&lt;h3&gt;CoreText åŸºç¡€&lt;/h3&gt;

&lt;p&gt;CoreText æ˜¯ç”¨äºå¤„ç†æ–‡å­—å’Œå­—ä½“çš„åº•å±‚æŠ€æœ¯ã€‚å®ƒç›´æ¥å’Œ Core Graphics äº¤äº’ï¼Œå…·æœ‰å¾ˆé«˜çš„æ–‡å­—æ¸²æŸ“æ•ˆç‡ã€‚CoreText å¯¹è±¡çš„æ¶æ„å›¾&lt;/p&gt;

&lt;div align=center&gt;
&lt;img src=&quot;../../../images/CoreText_1/core_text_arch_2x.png&quot; width = &quot;600&quot;/&gt;
&lt;/div&gt;

&lt;p&gt;CTFramesetter æ¥å— NSSAttributedString å’Œ CGPath å‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæˆ–è€…å¤šä¸ª CTFrameã€‚æ¯ä¸ª CTFrame ä»£è¡¨ä¸€ä¸ªæ®µè½ï¼ŒåŒ…å«ä¸€è¡Œæˆ–è€…å¤šè¡Œæ–‡å­—ï¼Œä¹Ÿå°±æ˜¯ CTLineã€‚åœ¨åˆ›å»º CTFrame æ—¶æœ‰å‡ ä¸ªç”Ÿæˆäº† CTLineï¼Œå®ƒå¯ä»¥ç›´æ¥æ¸²æŸ“åˆ° graphics contextã€‚CTRun æ˜¯ä¸€ç»„å…·æœ‰å…±åŒå±æ€§å’Œæ–¹å‘çš„è¿ç»­å­—å½¢(glyph)ï¼Œæ¯è¡Œå¯ä»¥æŠ¥è€ƒä¸€ä¸ªæˆ–è€…å¤šä¸ª CTRunã€‚&lt;/p&gt;

&lt;h4&gt;ç»˜åˆ¶ä¸€æ®µæ–‡å­—&lt;/h4&gt;

&lt;p&gt;ä½¿ç”¨ CoreText ç»˜åˆ¶ä¸€æ®µæ–‡å­—ä¸€èˆ¬éœ€è¦ä¼°ä¸‹è¿‡ç¨‹ï¼š
 * åˆ›å»º AttributedStringï¼Œå®šä¹‰æ®µè½ã€å­—ä½“ç­‰æ ·å¼
 * è·å– contextï¼Œæœ‰æ—¶è¿˜éœ€è¦è½¬æ¢ context çš„åæ ‡ç³»
 * åˆ›å»º CTFramesetterã€ç»˜åˆ¶åŒºåŸŸçš„ Pathï¼Œç”Ÿæˆ CTFrame
 * ç»˜åˆ¶ï¼Œæ•´æ®µç»˜åˆ¶ï¼ˆCTFrameDrawï¼‰æˆ–è€…é€è¡Œç»˜åˆ¶ï¼ˆCTLineDrawï¼‰&lt;/p&gt;

&lt;p&gt;ä¸‹é¢çš„ä»£ç é€è¡Œç»˜åˆ¶äº†ä¸€æ®µæ–‡å­—ï¼Œå¹¶ä¸ºæ¯ä¸€è¡Œç”»äº†ä¸€ä¸ªçº¢è‰²è¾¹æ¡†ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt; // UIView å­ç±»ä¸­
- (void)drawRect:(CGRect)rect
{
    // 1. è·å– context
    CGContextRef context = UIGraphicsGetCurrentContext();

    // 2. ç¿»è½¬åæ ‡ç³»
    CGContextSetTextMatrix(context, CGAffineTransformIdentity);
    CGContextTranslateCTM(context, 0, self.bounds.size.height);
    CGContextScaleCTM(context, 1.0, -1.0);

    // 3. CTFramesetterRef
    CTFramesetterRef frameSetter = CTFramesetterCreateWithAttributedString((CFAttributedStringRef)self.attrString);

    // 4. åˆ›å»ºç»˜åˆ¶åŒºåŸŸ
    CGMutablePathRef path = CGPathCreateMutable();
    CGPathAddRect(path, NULL, self.bounds);

    // 5. åˆ›å»º CTFrame
    CTFrameRef frame = CTFramesetterCreateFrame(frameSetter, CFRangeMake(0, self.attrString.length), path, NULL);


    // 6. ç»˜åˆ¶
    //CTFrameDraw(frame, context);

    // é€è¡Œç»˜åˆ¶
    CFArrayRef Lines = CTFrameGetLines(frame);
    CFIndex lineCount = CFArrayGetCount(Lines);
    CGPoint origins[lineCount];
    CTFrameGetLineOrigins(frame, CFRangeMake(0, 0), origins);
    for (CFIndex i = 0 ; i &amp;lt; lineCount; i ++) {
        CTLineRef line = CFArrayGetValueAtIndex(Lines, i);

        CGPoint lineOrigin = origins[i];
        CGContextSetTextPosition(context, lineOrigin.x, lineOrigin.y);

        CGRect lineBounds = CTLineGetImageBounds((CTLineRef)line, context);
        NSLog(@&amp;quot;lineBounds = %@&amp;quot;,NSStringFromCGRect(lineBounds));

        CGContextSetLineWidth(context, 1.0);
        CGContextAddRect(context, lineBounds);
        CGContextSetStrokeColorWithColor(context, [UIColor redColor].CGColor);
        CGContextStrokeRect(context, lineBounds);
        CTLineDraw(line, context);
    }

    CFRelease(frame);
    CFRelease(path);
    CFRelease(frameSetter);
}

- (void)setAttrString:(NSAttributedString *)attrString
{
    if (_attrString != attrString) {
        _attrString = attrString;
        [self setNeedsDisplay];
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;ç»˜åˆ¶çš„æ–‡å­—ï¼š&lt;/p&gt;

&lt;div align=center&gt;
&lt;img src=&quot;../../../images/CoreText_1/DrawLines.jpg&quot; width = &quot;400&quot;/&gt;
&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;ä¸Šé¢ä»£ç ä¸­ç¿»è½¬äº†åæ ‡ç³»ï¼Œè¿™æ˜¯å› ä¸º &lt;code&gt;drawRect:&lt;/code&gt; æ–¹æ³•ä¸­è·å–çš„å½“å‰ contenx å·²ç»è¢«è°ƒæ•´ä¸º UIKit çš„åæ ‡ç³»äº†ï¼ˆå·¦ä¸Šè§’æ˜¯åŸç‚¹ï¼‰ï¼Œä½†æ˜¯ CoreText ä½¿ç”¨çš„æ˜¯ Core Graphics çš„åæ ‡ç³»ï¼ˆå·¦ä¸‹è§’æ˜¯åŸç‚¹ï¼‰ï¼Œæ‰€ä»¥è¦æŠŠå½“å‰ context åæ ‡ç³»è¿˜åŸæˆå·¦ä¸‹è§’ä¸ºåŸç‚¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3&gt;é•‚ç©ºæ–‡å­—æ•ˆæœ&lt;/h3&gt;

&lt;p&gt;å®ç°é•‚ç©ºæ–‡å­—æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯è¯·è®¾è®¡å¸ˆç»™ä¸€ä¸ªæ–‡å­—é•‚ç©ºçš„åˆ‡å›¾ï¼Œå¦‚æœæ–‡æ¡ˆæ˜¯åŠ¨æ€é…ç½®çš„ï¼Œè¿™ç§æ–¹æ³•å°±ä¸è¡Œäº†ã€‚ä½¿ç”¨ä»£ç å®ç°é•‚ç©ºæ•ˆæœè¦ç”¨åˆ° CALayer çš„ mask å±æ€§ã€‚mask ä¹Ÿæ˜¯ä¸€ä¸ª CALayer å¯¹è±¡ï¼Œä½†åªæ˜¯ç”¨åˆ°å®ƒçš„è½®å»“ï¼Œåœ¨è½®å»“å†…çš„çˆ¶å›¾å±‚æ‰èƒ½æ˜¾ç¤ºå‡ºæ¥ã€‚&lt;/p&gt;

&lt;div align=center&gt;
 &lt;img src=&quot;../../../images/CoreText_1/calayer_mask.jpg&quot; width = &quot;400&quot;/&gt;
&lt;/div&gt;

&lt;p&gt;ä¸ºäº†å®ç°æ–‡å­—é•‚ç©ºæ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© CoreText å–å‡ºæ–‡å­—çš„ Pathï¼Œåˆ›å»º CAShapeLayer ç»˜åˆ¶å‡ºæ–‡å­—å¤–éƒ¨çš„è½®å»“ï¼Œå°† CAShapeLayer ä½œä¸ºå®¿ä¸»å›¾å±‚çš„ maskã€‚&lt;/p&gt;

&lt;p&gt;ç¬¬ä¸€æ­¥ï¼Œå–å‡ºæ–‡å­—çš„ pathã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;+ (UIBezierPath *)singleLinePathWithText:(NSString *)text font:(UIFont *)font
{
    CTFontRef ctFont = CTFontCreateWithName((__bridge CFStringRef)font.fontName, font.pointSize, NULL);
    if (!ctFont) {
        return nil;
    }
    // åˆ›å»º attributedString
    NSDictionary *attrs = @{(__bridge id)kCTFontAttributeName : (__bridge id)ctFont};
    NSAttributedString *attrString = [[NSAttributedString alloc] initWithString:text attributes:attrs];
    CFRelease(ctFont);

    // åˆ›å»º Line
    CTLineRef line = CTLineCreateWithAttributedString((__bridge CFTypeRef)attrString);
    if (!line) {
        return nil;
    }

    CGMutablePathRef cgPath = CGPathCreateMutable();
    CFArrayRef runs = CTLineGetGlyphRuns(line);
    for (CFIndex iRun = 0, iRunMax = CFArrayGetCount(runs); iRun &amp;lt; iRunMax; iRun ++) {
        CTRunRef run = (CTRunRef)CFArrayGetValueAtIndex(runs, iRun);
        CTFontRef runFont = CFDictionaryGetValue(CTRunGetAttributes(run), kCTFontAttributeName);
        for (CFIndex iGlyph = 0, iGlyphMax = CTRunGetGlyphCount(run); iGlyph &amp;lt; iGlyphMax; iGlyph++) {
            CFRange glyphRange = CFRangeMake(iGlyph, 1);
            CGGlyph glyph;
            CGPoint position;
            CTRunGetGlyphs(run, glyphRange, &amp;amp;glyph);
            CTRunGetPositions(run, glyphRange, &amp;amp;position);
            // è¯»å–æ–‡å­—çš„ path
            CGPathRef glyphPath = CTFontCreatePathForGlyph(runFont, glyph, NULL);
            if (glyphPath) {
                CGAffineTransform transform = CGAffineTransformMakeTranslation(position.x, position.y);
                CGPathAddPath(cgPath, &amp;amp;transform, glyphPath);
                CGPathRelease(glyphPath);
            }
        }
    }

    UIBezierPath *path = [UIBezierPath bezierPathWithCGPath:cgPath];
    CGRect boundingBox = CGPathGetPathBoundingBox(cgPath);
    CFRelease(cgPath);
    CFRelease(line);

    // ç¿»è½¬åæ ‡ç³»ï¼ˆå˜æˆå·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼‰
    [path applyTransform:CGAffineTransformMakeScale(1.0, -1.0)];
    [path applyTransform:CGAffineTransformMakeTranslation(0.0, boundingBox.size.height)];

    return path;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;ç¬¬äºŒæ­¥ï¼Œåˆ›å»º masklayerã€‚æˆ‘å°è£…äº†ä¸€ä¸ªç®€å•çš„ Viewï¼Œå°†æ–‡å­—ç½®äºä¸è§†å›¾çš„ä¸­é—´ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;// UIView å­ç±»
@implementation ZDXCutoutLabel

- (void)updateWithText:(NSString *)text font:(UIFont *)font
{
    UIBezierPath *path = [UIBezierPath bezierPathWithRect:self.bounds];
    UIBezierPath *textPath = [UIBezierPath singleLinePathWithText:text font:font];

    CGRect textRect = CGPathGetPathBoundingBox(textPath.CGPath);
    CGRect centerRect = RectCenteredInRect(textRect, self.bounds);
    CGAffineTransform tansform = CGAffineTransformMakeTranslation(centerRect.origin.x - textRect.origin.x, centerRect.origin.y - textRect.origin.y);
    [textPath applyTransform:tansform];
    [path appendPath:textPath];

    CAShapeLayer *pathLayer = [CAShapeLayer layer];
    pathLayer.path = [path CGPath];
    self.layer.mask = pathLayer;
}

@end
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;é•‚ç©ºæ–‡å­—æ•ˆæœï¼ŒèƒŒæ™¯æ˜¯ä¸€ä¸ª gif å›¾ç‰‡ã€‚&lt;/p&gt;

&lt;div align=center&gt;
 &lt;img src=&quot;../../../images/CoreText_1/cutout_text.gif&quot; width = &quot;300&quot;/&gt;
&lt;/div&gt;

&lt;p&gt;å›¾å±‚ç»“æ„:&lt;/p&gt;

&lt;div align=center&gt;
 &lt;img src=&quot;../../../images/CoreText_1/cutout_arc.jpg&quot; width = &quot;400&quot;/&gt;
&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/daxiazhou/Demos/tree/master/NSStringPathDemo&quot;&gt;Demo åœ¨è¿™é‡Œ&lt;/a&gt;&lt;/p&gt;
</description>
        <pubDate>Sun, 06 Jan 2019 18:36:24 +0800</pubDate>
        <link>http://zdaxia.com/2019/01/CoreText-%E5%AE%9E%E7%8E%B0%E9%95%82%E7%A9%BA%E6%96%87%E5%AD%97%E6%95%88%E6%9E%9C/</link>
        <guid isPermaLink="true">http://zdaxia.com/2019/01/CoreText-%E5%AE%9E%E7%8E%B0%E9%95%82%E7%A9%BA%E6%96%87%E5%AD%97%E6%95%88%E6%9E%9C/</guid>
        
        
      </item>
    
      <item>
        <title>è¯†åˆ« Emoji è¡¨æƒ…</title>
        <description>&lt;p&gt;åœ¨å¤„ç†ç”¨æˆ·è¾“å…¥çš„å†…å®¹æ—¶å€™ï¼Œæœ‰äº›åœºæ™¯ä¸å¸Œæœ›è¾“å…¥ emojiï¼Œåœ¨ iOS ä¸­å¦‚ä½•æ£€æµ‹ emojiï¼Ÿç»“åˆç½‘ä¸Šçš„ä¸€äº›èµ„æ–™ï¼Œæˆ‘æ€»ç»“ä¸€ä¸‹è¯†åˆ« emoji çš„æ–¹æ³•ï¼Œåœ¨ä»‹ç» emoji ä¹‹å‰å…ˆäº†è§£ä¸‹å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç ç›¸å…³çš„åŸºç¡€çŸ¥è¯†ã€‚&lt;/p&gt;

&lt;h3&gt;Unicode å­—ç¬¦é›†&lt;/h3&gt;

&lt;p&gt;Unicode æ ‡å‡†ä¸ºä¸–ç•Œä¸Šå‡ ä¹æ‰€æœ‰çš„[&lt;sup&gt;1]ä¹¦å†™ç³»ç»Ÿé‡Œæ‰€ä½¿ç”¨çš„æ¯ä¸€ä¸ªå­—ç¬¦æˆ–ç¬¦å·å®šä¹‰äº†ä¸€ä¸ªå”¯ä¸€çš„æ•°å­—ã€‚è¿™ä¸ªæ•°å­—å«åšç ç‚¹ï¼ˆcode&lt;/sup&gt; pointsï¼‰ï¼Œä»¥ U+xxxx è¿™æ ·çš„æ ¼å¼å†™æˆï¼Œæ ¼å¼é‡Œçš„ xxxx ä»£è¡¨å››åˆ°å…­ä¸ªåå…­è¿›åˆ¶çš„æ•°ã€‚&lt;/p&gt;

&lt;p&gt;æœ€åˆï¼ŒUnicode ç¼–ç æ˜¯è¢«è®¾è®¡ä¸º 16 ä½çš„ï¼Œæä¾›äº† 65,536 ä¸ªå­—ç¬¦çš„ç©ºé—´ã€‚åæ¥ï¼Œè€ƒè™‘åˆ°è¦ç¼–ç å†å²ä¸Šçš„æ–‡å­—ä»¥åŠä¸€äº›å¾ˆå°‘ä½¿ç”¨çš„æ—¥æœ¬æ±‰å­—å’Œä¸­å›½æ±‰å­—ï¼ŒUnicode ç¼–ç æ‰©å±•åˆ°äº† 21 ä½ï¼ˆä» U+0000 åˆ° U+10FFFFï¼‰ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ç°åœ¨æ¥è§¦åˆ°çš„ Unicode æ˜¯ 21 ä½çš„ç¼–ç ã€‚&lt;/p&gt;

&lt;p&gt;ç¼–ç ç©ºé—´è¢«åˆ†æˆ 17 ä¸ªå¹³é¢ï¼ˆplaneï¼‰ï¼Œæ¯ä¸ªå¹³é¢æœ‰ 65,536 ä¸ªå­—ç¬¦ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../../images/UnicodePlanes.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;

&lt;p&gt;0 å·å¹³é¢å«åšã€ŒåŸºæœ¬å¤šæ–‡ç§å¹³é¢ã€ï¼ˆBasic Multilingual Plane, BMPï¼‰ï¼Œæ¶µç›–äº†å‡ ä¹æ‰€æœ‰ä½ èƒ½é‡åˆ°çš„å­—ç¬¦ã€‚å…¶å®ƒå¹³é¢å«åšè¡¥å……å¹³é¢ï¼Œå¤§å¤šæ˜¯ç©ºçš„ã€‚&lt;/p&gt;

&lt;h3&gt;UTF ç¼–ç &lt;/h3&gt;

&lt;p&gt;Unicode å®šä¹‰äº†å­—ç¬¦åˆ°ç ç‚¹çš„æ˜ å°„ï¼Œå…·ä½“å¦‚ä½•åœ¨è®¡ç®—æœºä¸Šå­˜å‚¨ï¼Œå°±éœ€è¦ä½¿ç”¨ UTF ï¼ˆUnicode Transformation Formatsï¼Œç®€ç§° UTFï¼‰ç¼–ç äº†ã€‚å¸¸è§çš„ç¼–ç æ ¼å¼æœ‰ UIF-32ã€UTF-16 å’Œ UTF-8ï¼Œçœ‹åå­—å°±çŸ¥é“å®ƒä»¬å«ä¹‰ï¼Œ32ã€16ã€8 è¡¨ç¤ºç”¨äºå­˜å‚¨çš„é•¿åº¦ã€‚ä½¿ç”¨ 32 ä½å­˜å‚¨ä¸€ä¸ªç ç‚¹ï¼ˆç ç‚¹é•¿åº¦ 21 ä½ï¼‰å¤ªæµªè´¹ç©ºé—´äº†ï¼Œç°å®ä¸­å¾ˆå°‘ä½¿ç”¨ã€‚UTF-16 ä½¿ç”¨ 16 ä½å›ºå®šé•¿åº¦çš„ç å…ƒï¼ŒBMP çš„èŒƒå›´åœ¨ 0000-FFFF ä¹‹é—´ï¼Œä¸€ä¸ªç ç‚¹ç›´æ¥ä¸ä¸€ä¸ªç å…ƒç›¸æ˜ å°„ï¼Œä½¿ç”¨ UTF-16 æ¯” UTF-32 èŠ‚çœä¸€åŠçš„ç©ºé—´ã€‚å…¶å®ƒå¹³é¢çš„å­—ç¬¦è¶…è¿‡äº† 16 ä½çš„è¡¨ç¤ºèŒƒå›´ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ä¸ª UTF-16 ç å…ƒç»„åˆèµ·æ¥è¡¨ç¤ºï¼Œå«åšä»£ç†å¯¹ï¼ˆsurrogate pairï¼‰ã€‚NSString ä½¿ç”¨çš„å°±æ˜¯ UTF-16 ç¼–ç å­˜å‚¨å­—ç¬¦ä¸²ï¼Œä¸‹é¢ä¼šè¯¦ç»†ä»‹ç»ã€‚UTF-8 çš„ç”¨é€”æ›´å¹¿æ³›ï¼Œå·²ç»æ˜¯æ–‡ä»¶æ ¼å¼ã€ç½‘ç»œåè®®ä»¥åŠ Web API é¢†åŸŸé‡Œäº‹å®ä¸Šçš„æ ‡å‡†äº†ï¼Œå®ƒä¸ emoji çš„å…³ç³»ä¸å¤§ï¼Œè¿™é‡Œä¸åšè¯¦ç»†ä»‹ç»äº†ã€‚&lt;/p&gt;

&lt;h3&gt;NSString å­˜å‚¨&lt;/h3&gt;

&lt;p&gt;NSString å¯¹è±¡ä»£è¡¨çš„å…¶å®æ˜¯ç”¨ UTF-16 ç¼–ç çš„ç å…ƒç»„æˆçš„æ•°ç»„ã€‚ç›¸åº”åœ°ï¼Œlength æ–¹æ³•çš„è¿”å›å€¼ä¹Ÿæ˜¯å­—ç¬¦ä¸²åŒ…å«çš„ç å…ƒä¸ªæ•°ï¼ˆè€Œä¸æ˜¯å­—ç¬¦ä¸ªæ•°ï¼‰ã€‚è¯•ç€æ‰“å° ğŸ˜›(U+1F61B) çš„é•¿åº¦ï¼Œè¾“å‡º 2ã€‚å› ä¸º U+1F61B è¶…å‡ºäº† BMP çš„èŒƒå›´ï¼Œéœ€è¦ä½¿ç”¨ä¸¤ä¸ª UTF-16 ç å…ƒç»„åˆæˆä»£ç†å¯¹è¡¨ç¤ºã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt; NSString *emoji = @&amp;quot;ğŸ˜›&amp;quot;;
 NSLog(@&amp;quot;emoji.length: %@&amp;quot;, @(emoji.length)); // emoji.length: 2
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨å·¥ä½œä¸­ç»å¸¸ä¼šé‡åˆ°é™åˆ¶ç”¨æˆ·è¾“å…¥å­—ç¬¦ä¸ªæ•°çš„éœ€æ±‚ï¼Œæ¯”å¦‚è¦æ±‚ç”¨æˆ·åæœ€é•¿ä¸è¶…è¿‡ 10 ä¸ªå­—ç¬¦ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨ length åˆ¤æ–­å°±å¯ä»¥äº†ï¼Œå¦‚æœç”¨æˆ·è¾“å…¥äº† emoji è¡¨æƒ…ï¼Œä½¿ç”¨ length åˆ¤æ–­å¯èƒ½å°±ä¸ç¬¦åˆè¦æ±‚äº†ã€‚ç”¨æˆ·è¾“å…¥äº† 3 ä¸ª ğŸ‘¨ğŸ»â€âš•ï¸ï¼ˆ1F468 1F3FB 200D 2695 FE0Fï¼‰ï¼Œæ‰“å°å‡ºlength çš„é•¿åº¦æ˜¯ 21ï¼ˆæ¯ä¸ª ğŸ‘¨ğŸ»â€âš•ï¸ é•¿åº¦ä¸º: 2 + 2 + 1 + 1 + 1ï¼‰ï¼Œå·²ç»è¶…è¿‡ 10 ï¼Œæç¤ºç”¨è¶…é•¿äº†è‚¯å®šä¸åˆç†ã€‚å¦‚ä½•åˆ¤æ–­å­—ç¬¦é•¿åº¦å‘¢ï¼Ÿ&lt;code&gt;enumerateSubstringsInRange:options:usingBlock:&lt;/code&gt; æ–¹æ³•ä»¥å­—ç¬¦ä¸ºå•ä½è¿›è¡Œéå†ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥ç»Ÿè®¡å­—ç¬¦çœŸæ­£çš„é•¿åº¦ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;NSString *emoji = @&amp;quot;ğŸ‘¨ğŸ»â€âš•ï¸ğŸ‘¨ğŸ»â€âš•ï¸ğŸ‘¨ğŸ»â€âš•ï¸&amp;quot;;
NSLog(@&amp;quot;length: %@&amp;quot;, @(emoji.length)); // length: 21

__block NSUInteger realLength = 0;
[emoji enumerateSubstringsInRange:NSMakeRange(0, emoji.length) options:NSStringEnumerationByComposedCharacterSequences usingBlock:^(NSString * _Nullable substring, NSRange substringRange, NSRange enclosingRange, BOOL * _Nonnull stop) {
    NSLog(@&amp;quot;==&amp;gt; subRange:%@, subStr:%@&amp;quot;, NSStringFromRange(substringRange), substring);
    realLength += 1;
}];
NSLog(@&amp;quot;realLength: %@&amp;quot;, @(realLength)); // realLength: 3

&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;h3&gt;emoji&lt;/h3&gt;

&lt;p&gt;ä»&lt;a href=&quot;https://en.wikipedia.org/wiki/Emoji&quot;&gt;ç»´åŸºç™¾ç§‘&lt;/a&gt;äº†è§£åˆ°ç›®å‰ emoji å·²ç»æ›´æ–°åˆ° &lt;a href=&quot;https://unicode.org/Public/emoji/11.0/&quot;&gt;11.0&lt;/a&gt;ï¼Œæ€»å…±æœ‰ 1212 ä¸ªå•ç ç‚¹çš„è¡¨æƒ…ï¼Œè¿˜æœ‰æ›´å¤šçš„è¡¨æƒ…å¯ä»¥é€šè¿‡å¤šä¸ªç ç‚¹ç»„åˆè€Œæˆã€‚å…·ä½“çš„ç»„åˆæ–¹å¼æœ‰ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Emoji_Keycap_Sequence: æ™®è°ƒçš„å­—ç¬¦ &lt;code&gt;#*0123456789&lt;/code&gt; åŠ ä¸Š FE0F 20E3 å°±å˜æˆäº† #ï¸âƒ£*ï¸âƒ£0ï¸âƒ£1ï¸âƒ£2ï¸âƒ£3ï¸âƒ£4ï¸âƒ£5ï¸âƒ£6ï¸âƒ£7ï¸âƒ£8ï¸âƒ£9ï¸âƒ£ã€‚&lt;/li&gt;
&lt;li&gt;Emoji_Flag_Sequence: å›½æ——è¡¨æƒ…ï¼Œè¿™ç±» emoji ä¸²æ˜¯é€šè¿‡ä¸¤ä¸ªåœ°åŸŸæŒ‡ç¤ºç¬¦ï¼ˆregional_indicatorï¼‰ç»„åˆçš„æ–¹å¼æ¥è¡¨ç¤ºä¸€ä¸ªå›½å®¶çš„å›½æ——ã€‚å¦‚ ğŸ‡¿ğŸ‡¼(1F1FF 1F1FC)ï¼Œæ€»å…± 258 ä¸ªã€‚&lt;/li&gt;
&lt;li&gt;Emoji_Modifier_Sequence: ä¸åŒè‚¤è‰²çš„è¡¨æƒ…ï¼Œå¦‚ â˜ï¸(261D) åŠ ä¸Š 1F3FF å°±å˜æˆäº† â˜ğŸ¿(261D 1F3FF)ï¼Œè¿™ç±»ä¸åŒè‚¤è‰²çš„è¡¨æƒ…æœ‰ 530 ä¸ªã€‚&lt;/li&gt;
&lt;li&gt;Emoji_ZWJ_Sequence: é€šè¿‡ ZWJ å­—ç¬¦ï¼ˆU+200Dï¼Œ Zero Width Joinerï¼‰å°†åŸºæœ¬ emoji å­—ç¬¦æˆ– Emoji_Modifier_Sequenceè¿æ¥èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„ emoji è¡¨ç¤ºæ ·å¼ï¼Œå¦‚ ğŸ‘¨â€â¤ï¸â€ğŸ‘¨(1F468 200D 2764 FE0F 200D 1F468) ç”± ğŸ‘¨(1F468) + â¤ï¸(2764 FE0F) + ğŸ‘¨(1F468) ç»„åˆè€Œæˆã€‚è¿™è¡¨æƒ…æ˜¯è¡¨ç¤ºä¸€å¯¹åŸºå‹ä¹ˆï¼Ÿ&lt;/li&gt;
&lt;li&gt;Emoji_Tag_Sequence: åªæœ‰ä¸‰ä¸ª ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿ã€ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿ã€ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿ã€‚&lt;/li&gt;
&lt;li&gt;Emoji_presentation_sequence: å³ç”±åŸºæœ¬ emoji å­—ç¬¦åŠ ä¸Š U+FE0F ç»„åˆè€Œæˆ emoji åºåˆ—ä¸²ã€‚ä¾‹å¦‚ â¤ï¸(U+26A1 U+FE0F)ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;è¯†åˆ«å­—ç¬¦ä¸²ä¸­çš„ emoji&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://unicode.org/Public/emoji/11.0/emoji-data.txt&quot;&gt;emoji-data.txt&lt;/a&gt; çš„ç¬¬ä¸€ä¸ªè¡¨æ ¼ä¸­åŒ…å«äº†æ‰€æœ‰çš„å•ç ç‚¹ï¼Œæ€»æ•°æ˜¯ 1250ï¼Œé™¤å» &lt;code&gt;#*&lt;/code&gt;ã€&lt;code&gt;0-9&lt;/code&gt;å’Œ &lt;code&gt;a-z&lt;/code&gt; æ­£å¥½ 1212 ä¸ªã€‚å¤šç ç‚¹ emoji ä¹Ÿæ˜¯ç”±å•ç ç‚¹ emoji è¿½åŠ ä¸€äº›ç‰¹æ®Šå­—ç¬¦ç»„åˆè€Œæˆï¼Œæ‰€ä»¥åªè¦å­—ç¬¦çš„ç¬¬ä¸€ä¸ªç ç‚¹åœ¨è¿™ä¸ªè¡¨æ ¼ç½—åˆ—çš„ç ç‚¹èŒƒå›´å†…ï¼Œå°±å¯ä»¥åˆ¤å®šå®ƒæ˜¯ emojiã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ç¬¬ä¸€æ­¥&lt;/strong&gt;ï¼Œæå–è¡¨æ ¼ä¸­çš„ç ç‚¹ã€‚æˆ‘ç”¨ Python å†™äº†ä¸€ä¸ªç®€å•çš„è„šæœ¬æ ¼å¼åŒ–ç ç‚¹èŒƒå›´ï¼Œè¾“å‡ºä¸€ä¸ªæ•°ç»„å¤åˆ¶åˆ° OC ä»£ç ä¸­ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import sys
import os

# ä½¿ç”¨æ–¹æ³•ï¼Œ python3 getEmojiData.py emoji-data.txt emoji-all-data.txt

readPath = os.path.join(os.path.abspath(&amp;#39;.&amp;#39;), sys.argv[1])

resultStr = &amp;#39;&amp;#39;
with open(readPath, &amp;#39;r&amp;#39;) as f:
    for line in f.readlines():
        codeStr = line.partition(&amp;#39;;&amp;#39;)[0]
        if len(codeStr.rstrip()) == 0:
            continue
        pointList = codeStr.rstrip().split(&amp;#39;..&amp;#39;)
        formatPair = &amp;#39;&amp;#39;
        if len(pointList) == 1:
            formatPair = &amp;#39;{0x%s, 0x%s},&amp;#39; % (pointList[0], pointList[0])
        else:
            formatPair = &amp;#39;{0x%s, 0x%s},&amp;#39; % (pointList[0], pointList[1])
        resultStr = resultStr + &amp;#39;\n&amp;#39; + formatPair

writePath = os.path.join(os.path.abspath(&amp;#39;.&amp;#39;), sys.argv[2])
with open(writePath, &amp;#39;w&amp;#39;) as f:
    f.write(resultStr)
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨ OC ä»£ç ä¸­åˆ›å»ºä¸€ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;typedef struct {
    uint32_t start;
    uint32_t end;
} CodePair;

static CodePair CodePairList[] = {
    {0x00A9, 0x00A9},
    {0x00AE, 0x00AE},
    {0x203C, 0x203C},
    xxx

   };
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬äºŒæ­¥&lt;/strong&gt;ï¼Œéå†å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼Œæå–å­—ç¬¦çš„ç¬¬ä¸€ä¸ªç ç‚¹ï¼Œåˆ¤æ–­æ˜¯å¦åœ¨èŒƒå›´å†…ã€‚è¦åŒºåˆ†ä¸¤ç§æƒ…å†µï¼Œemoji æ˜¯å•ç ç‚¹çš„ï¼Œå¦‚ Â©ï¸(U+00A9)ï¼Œç›´æ¥ç”¨ &lt;code&gt;characterAtIndex&lt;/code&gt; å–ç ç‚¹ï¼›å¤§éƒ¨åˆ† emoji çš„ç ç‚¹æ•° &amp;gt;= 2ï¼Œç›´æ¥ä½¿ç”¨ &lt;code&gt;characterAtIndex&lt;/code&gt; å°±ä¸è¡Œäº†ã€‚ä¾‹å¦‚ğŸ˜€(1F600)ï¼Œæ‰“å°å‡ºæ¥å¾—ç»“æœæ˜¯ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;NSString *emoji = @&amp;quot;ğŸ˜€&amp;quot;;
NSLog(@&amp;quot;%x, %x&amp;quot;, [emoji characterAtIndex:0], [emoji characterAtIndex:1]); // d83d, de00
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;Unicode ä¸­æœ‰ 17 ä¸ªå¹³é¢ï¼Œåœ¨ç¬¬ 0 å¹³é¢ä¸­ï¼Œæœ‰ä¸€ä¸ªç‰¹æ®Šçš„ä»£ç†åŒºåŸŸï¼Œä¸è¡¨ç¤ºä»»ä½•å­—ç¬¦ï¼Œåªç”¨äºæŒ‡å‘ç¬¬ 1 åˆ°ç¬¬ 16 ä¸ªå¹³é¢ä¸­çš„å­—ç¬¦ï¼Œè¿™æ®µåŒºåŸŸæ˜¯ï¼šD800â€”DFFF.ã€‚å…¶ä¸­ 0xD800â€”0xDBFF æ˜¯å‰å¯¼ä»£ç†(lead surrogates)ï¼Œ0xDC00â€”0xDFFF æ˜¯åå°¾ä»£ç†(trail surrogates)ã€‚å…·ä½“çš„å…¬å¼ï¼š&lt;code&gt;0x10000 + (å‰å¯¼-0xD800) * 0x400 + (åå¯¼-0xDC00) = utf-16ç¼–ç &lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;NSString *emoji = @&amp;quot;ğŸ˜€&amp;quot;;
const unichar hs = [emoji characterAtIndex:0];
if (0xd800 &amp;lt;= hs &amp;amp;&amp;amp; hs &amp;lt;= 0xdbff) {
    if (emoji.length &amp;gt; 1) {
        const unichar ls = [emoji characterAtIndex:1];
        const int uc = ((hs - 0xd800) * 0x400) + (ls - 0xdc00) + 0x10000;
        NSLog(@&amp;quot;%x&amp;quot;, uc); // 1f600
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;h4&gt;å‚è€ƒæ–‡æ¡£&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://objccn.io/issue-9-1/&quot;&gt;objccn.io: NSString ä¸ Unicode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://mupceet.com/2018/07/emoji-distinguish&amp;amp;filter/&quot;&gt;ä¸€ä¸ªå®‰å“åŒå­¦æ€»ç»“çš„: Emoji è¯†åˆ«ä¸è¿‡æ»¤&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://unicode.org/Public/emoji/11.0/&quot;&gt;emoji/11.0&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.jianshu.com/p/9682f8ce1260&quot;&gt;Emojiï¼Œæ²¡æƒ³åˆ°ä½ æ˜¯è¿™æ ·çš„...&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Wed, 02 Jan 2019 04:36:24 +0800</pubDate>
        <link>http://zdaxia.com/2019/01/%E8%AF%86%E5%88%AB%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84-emoji-%E8%A1%A8%E6%83%85/</link>
        <guid isPermaLink="true">http://zdaxia.com/2019/01/%E8%AF%86%E5%88%AB%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84-emoji-%E8%A1%A8%E6%83%85/</guid>
        
        
      </item>
    
  </channel>
</rss>
